(this["webpackJsonpbell-client"]=this["webpackJsonpbell-client"]||[]).push([[0],{10:function(e,t,n){e.exports=n(17)},15:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(6),s=n.n(i),l=(n(15),n(9)),c=(n(16),n(1)),u=n(4),o=n(7),h=n(8),d={deckSize:20,deckOptions:[0,1,2,3,4,5],demoDeck:[0,5,5,0]},g=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*t),r=e[t];e[t]=e[n],e[n]=r}return e},f=function(){function e(t,n){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=a.debug,s=a.setter;Object(o.a)(this,e),this.debug=i,this.setter=s,this.deckOptions=d.deckOptions,this.log=[],this.turns=[],this.logger=function(e){return r.log.push(e)},this.logger("constructor"),this._start=!1,this._end=!1,this.numOfPlayers=t,this.deckSize=n||d.deckSize,this.deck=this.debug?d.demoDeck:this.genDeck(this.deckSize),this.playerDeckSize=Math.floor(this.deckSize/this.numOfPlayers),this.players=Array(t).fill(0).map((function(e,t){return r.createPlayer(t+1)}))}return Object(h.a)(e,[{key:"genDeck",value:function(e){var t=this;return this.logger("genDeck"),g(Array(e).fill(0).map((function(){return t.deckOptions[Math.round(Math.random()*t.deckOptions.length-1)]})))}},{key:"sync",value:function(){var e={start:this._start,end:this._end,players:this.players,turns:this.turns};this.debug&&(console.log("state",e),console.log("game log:",this.log)),this.setter&&this.setter(e)}},{key:"start",value:function(){this.logger("start"),this._start=!0,this.sync()}},{key:"end",value:function(){this.logger("end"),this._end=!0,this.sync()}},{key:"createPlayer",value:function(e){return this.logger("createPlayer"),{id:e,deck:this.deck.slice(this.playerDeckSize*(e-1),this.playerDeckSize*e),ready:!1,lose:!1,win:!1}}},{key:"readyPlayer",value:function(e){this.logger("readyPlayer:"+e),this.players=this.players.map((function(t){return Object(u.a)({},t,{ready:!(e&&!t.ready)||t.id===e})})),this.sync()}},{key:"allNotReady",value:function(){this.logger("allNotReady"),this.players=this.players.map((function(e){return Object(u.a)({},e,{ready:!1})})),this.sync()}},{key:"isReady",value:function(){var e=!this.players.some((function(e){return!e.ready&&!e.lose}));return this.logger("isReady:"+e),e}},{key:"returnDeckAndShuffle",value:function(){this.logger("returnDeckAndShuffle");var e=this.turns.length-1,t=Object(c.a)(this.turns);if(!t.find((function(e){return e.win||e.shuffle})))e=0;else for(var n=t.length-1;n>=0;n--){var r=t[n];if(!0===r.win){e=n;break}if(!0===r.shuffle&&n<t.length-1){e=n+1;break}}var a=t.slice(e).map((function(e){return e.cards})).flat(1);console.log({cards:a,lastWin:e}),t[t.length-1].draw=!0,t[t.length-1].shuffle=!0,this.turns=t;var i=this.players.map((function(e){var t=a.filter((function(t){return t.playerId===e.id})).map((function(e){return e.value}));return e.deck=[].concat(Object(c.a)(e.deck),Object(c.a)(t)),e.deck=g(e.deck),e}));this.players=i,this.sync()}},{key:"getLastDrawTurns",value:function(){var e=this;return this.logger("getLastDrawTurns"),this.turns.reduce((function(t,n,r){return n.win||n.shuffle&&r<e.turns.length-1?t=[]:n.draw&&(t=[].concat(Object(c.a)(t),[n])),t}),[])}},{key:"nextTurn",value:function(){if(this.isReady()&&this._start&&!this._end){if(this.logger("nextTurn"),this.turns.length>0){var e=this.turns[this.turns.length-1].win;this.getLastDrawTurns().length>0&&!e&&this.players.find((function(e){return 0===e.deck.length&&!e.lose}))&&this.returnDeckAndShuffle()}this.turns=[].concat(Object(c.a)(this.turns),[{win:!1,draw:!0,cards:this.players.map((function(e){return{playerId:e.id,value:e.deck.length>0?e.deck[0]:0}}))}]),this.players=this.players.map((function(e){return Object(u.a)({},e,{deck:e.deck.slice(1),ready:!1})})),this.sync()}}},{key:"ring",value:function(e){var t=this;this.logger("ring");var n=Object(c.a)(this.turns),r=Object(c.a)(this.players);if(5===n[n.length-1].cards.reduce((function(e,t){return e+t.value}),0)){if(!1!==n[n.length-1].win)return;n[n.length-1].win=e,n[n.length-1].draw=!1,this.logger("player ".concat(e," win this turn.")),this.turns=n;var a=r.some((function(t){return t.deck.length>0&&t.id!==e}));a||this.end(),r.map((function(r){return r.id===e?(r.deck=[].concat(Object(c.a)(r.deck),Object(c.a)(n[n.length-1].cards.map((function(e){return e.value})))),a||(r.win=!0,t.logger("player ".concat(r.id," win.")))):a||(r.lose=!0,t.logger("player ".concat(r.id," lose."))),r})),this.players=r}else{var i=r.find((function(t){return t.id===e})),s=r.length-2<1?1:r.length-2,l=i.deck.slice(0,s),u=i.deck.slice(s);this.players=r.map((function(t){return t.id===e?t.deck=u:l.length>0&&(t.deck=[].concat(Object(c.a)(t.deck),[l[0]]),l=l.slice(1)),t})),this.turns[this.turns.length-1].draw=!0,this.logger("this turn is a draw.")}this.sync()}}]),e}(),m=function(e){var t=e.game,n=Object(r.useState)({players:[],turns:[],start:!1,end:!1}),i=Object(l.a)(n,2),s=i[0],c=i[1];t.setter=c,Object(r.useEffect)((function(){t.nextTurn()}),[s]);var u=[];s.start&&!s.end&&s.turns.length>0&&(u=s.turns[s.turns.length-1].cards.map((function(e){return function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*t),r=e[t];e[t]=e[n],e[n]=r}return e}(Array(5).fill().map((function(t,n){return n<e.value})).map((function(e,t){return a.a.createElement("span",{className:e?"circle bg-green-600":"circle bg-red-600"})})))})));var o=t.getLastDrawTurns();return a.a.createElement("div",{className:"container mx-auto"},a.a.createElement("h2",null,s.start&&!s.end?"game running.":"game not running."),a.a.createElement("div",null,a.a.createElement("button",{className:"btn btn-blue mr-8",onClick:function(){return t.readyPlayer()}},"Ready"),a.a.createElement("button",{className:"btn btn-blue mr-8",onClick:function(){return t.start()}},"Start"),a.a.createElement("button",{className:"btn btn-blue mr-8",onClick:function(){return t.end()}},"End")),a.a.createElement("div",{className:"flex"},s.players.map((function(e){return a.a.createElement("div",{className:"flex-1 text-center items-center"},a.a.createElement("span",{className:"circle bg-red-600 leading-p4",onClick:function(){return t.readyPlayer(e.id)}},e.ready?"Ready":"Not Ready"),a.a.createElement("span",{className:"circle bg-green-600 leading-p4",onClick:function(){return t.ring(e.id)}},"Ring"),a.a.createElement("div",null,"Player ",e.id," (cards:",e.deck.length,") ",a.a.createElement("br",null),e.win?"Winner!":e.lose?"Loser!":""))}))),a.a.createElement("div",null,a.a.createElement("h3",null,"Board (",o.length,")"),a.a.createElement("div",{className:"flex"},u.map((function(e){return a.a.createElement("div",{className:"flex-1 text-center items-center"},a.a.createElement("div",{className:"border border-gray-600 w-1/2"},e.slice(0,2),a.a.createElement("br",null),e[2],a.a.createElement("br",null),e.slice(3)))})))),a.a.createElement("div",null,a.a.createElement("h3",null,"Game Log:"),a.a.createElement("div",{className:"overflow-scroll log-h"},a.a.createElement("ul",null,t.log.map((function(e){return a.a.createElement("li",null,e)}))))))},y=function(){var e=new f(2);return a.a.createElement(m,{game:e})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[10,1,2]]]);
//# sourceMappingURL=main.52a9ec69.chunk.js.map